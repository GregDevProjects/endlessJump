<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Jetman</title>
        <!-- // <script type="text/javascript" src="cordova.js"></script> -->
        <script src="phaser/phaser.js"></script>

        <!--<script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>-->
        <script src="game.js"></script>
        <script src="platforms.js"></script>
        <script src="player.js"></script>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
            <style>
        body, html {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
    background-color: black !important
}

</style>
    </head>
    <body>

    <script type="text/javascript">
    //globals go here for now
    var game;
    var player;
    window.onload = function() {

        //  Note that this html file is set to pull down Phaser 2.5.0 from the JS Delivr CDN.
        //  Although it will work fine with this tutorial, it's almost certainly not the most current version.
        //  Be sure to replace it with an updated version before you start experimenting with adding your own code.
        var width = window.innerWidth;// * window.devicePixelRatio;
        var height = window.innerHeight;// * window.devicePixelRatio;
        //var game;
        game = new Phaser.Game(width, height, Phaser.CANVAS, '', { preload: preload, create: create, update: update, render: render });
        
       // new Phaser.Game(, , Phaser.CANVAS, 'gameArea')

        function preload () {
            game.load.image('platform', 'platform.png');
            game.load.image('player', 'player.png');
            game.load.image('ground', 'ground.png');
        }

        function create () {
            
            setPhysics();
            initPlatforms();
            player = new Player();
            setBounds();
             game.input.onUp.add(onUp, this);
             game.input.onHold.add(onHold, this);
             //game.input.onDown.add(onDown, this);
             game.input.onUp.add(onUp, this);
           // game.input.addPointer();
        }

        function update() {
            game.physics.arcade.collide(player.player, ground, onGroundCollision, null, this);
            game.physics.arcade.overlap(player.player, platforms, onPlatformCollision, null, this);
            game.input.onHold.add(onDown, this);
           // player.handleControlls();
           // if(game.input.pointer1.isDown){
           //      console.log('down');
           //      onDown(game.input.pointer1);
           // }

           // if(game.input.pointer1.isUp){
           //      onUp(game.input.pointer1);
           // } 

         //  game.input.onDown.add(onDown, this);

            // if(game.input.pointer1.isDown){
            //      onUp('pointer')
            // }
            // else{
                
            // }
            
             if (game.input.activePointer.isDown) {
                  onHold(game.input.activePointer);
             }

           // game.input.pointer1.isUp.add(onUp, this);
        }

        function render() {

            //  Just renders out the pointer data when you touch the canvas
            game.debug.pointer(game.input.activePointer);


        }

        function onDown(pointer) {

            dragStyleMove(pointer.x, player.player.x);
           // console.log(pointer.x)
        }

        function onHold(pointer){
            dragStyleMove(pointer.x, player.player.x);
        }

        function onUp(pointer){
            player.stop();
        }

        function dragStyleMove(tapPositionX, playerPositionX){
            var playerMiddle = playerPositionX + player.player.width/2;

            //console.log(tapPositionX, playerMiddle );
            if (playerMiddle - 5 <= tapPositionX && playerMiddle + 5 >= tapPositionX){
                player.stop();
                return;
            }

            if (tapPositionX >  playerMiddle) {
                player.moveRight();    
            } else if (tapPositionX < playerMiddle){
                player.moveLeft();
            } 

        }

        function buttonStyleMove(xPosition){
            if(xPosition > width/2){
                console.log('right');
                player.moveRight();
            } else {
                player.moveLeft();
                console.log('left');
            }  
        }

    };

    </script>

    </body>
</html>